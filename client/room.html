<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Room Name</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous" />
  <style>
    #messages {
      height: 60vh;
      overflow-y: scroll;
    }

  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="#">ChatSocket</a>
      <div class="navbar-nav">
        <a class="nav-link" href="/chat">Chat</a>
        <a class="nav-link" href="logout.html">Logout</a>
      </div>
    </div>
  </nav>
  <div class="container mt-5">
    <h1 class="text-center mb-5">Room Name</h1>
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div id="messages">
          <!-- Messages will be displayed here -->
        </div>
        <form id="message-form" class="mt-3">
          <div class="row">
            <div class="col-md-9">
              <input type="text" class="form-control" id="message-input" placeholder="Type your message...">
            </div>
            <div class="col-md-3">
              <button type="submit" class="btn btn-primary w-100">Send</button>
            </div>
          </div>
        </form>

        <script src="http://localhost:4000/socket.io/socket.io.js"></script>
        <script>
          const socket = io( "http://localhost:4000" );
          const messagesContainer = document.getElementById( "messages" );
          const messageForm = document.getElementById( "message-form" );
          const messageInput = document.getElementById( "message-input" );
          const urlParams = new URLSearchParams( window.location.search );
          const roomName = urlParams.get( "name" );

          // Join the room and get the room information from the server
          socket.emit( "join-room", roomName, ( room ) => {
            // Update the room name in the HTML
            const roomNameElement = document.querySelector( "h1" );
            roomNameElement.textContent = room.name;

            // Display the messages in the room
            room.messages.forEach( ( message ) => {
              addMessage( message );
            } );
          } );

          messageForm.addEventListener( "submit", ( event ) => {
            event.preventDefault();
            const message = messageInput.value;
            socket.emit( "send-message", { room: roomName, message: message } );
            messageInput.value = "";
          } );

          socket.on( "response-from-server", ( data ) => {
            addMessage( data );
          } );

          function addMessage ( data ) {
            const messageClass = data.isCurrentUser ? "bg-primary text-white" : "bg-secondary text-white";
            const messageHTML = `
              <div class="my-2 p-2 rounded ${ messageClass }">
                < span class="fw-bold" >${ data.username }</span>
                <span>${ data.message }</span>
              </div>
            `;
            messagesContainer.insertAdjacentHTML( "beforeend", messageHTML );
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }
        </script>
      </div>
    </div>
  </div>
</body>

</html>
