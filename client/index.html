<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Socket.io Client Example</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous" />
</head>

<body>
  <h1>Socket.io Client Example</h1>

  <div id="rooms-list">
    <h2>Rooms:</h2>
    <ul id="rooms"></ul>
  </div>

  <div id="chat" style="display: none">
    <h2 id="room-name"></h2>

    <div id="messages"></div>

    <form>
      <input id="message-input" type="text" placeholder="Type your message" />
      <button id="send-button" type="submit">Send</button>
    </form>
  </div>

  <script src="http://localhost:4000/socket.io/socket.io.js"></script>
  <script>
    const socket = io( 'http://localhost:4000' );


    // Selectors
    const roomsListDiv = document.getElementById( 'rooms-list' );
    const roomsUl = document.getElementById( 'rooms' );
    const chatDiv = document.getElementById( 'chat' );
    const roomNameH2 = document.getElementById( 'room-name' );
    const messagesDiv = document.getElementById( 'messages' );
    const messageInput = document.getElementById( 'message-input' );
    const sendButton = document.getElementById( 'send-button' );

    // Show/hide chat and rooms list
    function showRooms () {
      roomsListDiv.style.display = 'block';
      chatDiv.style.display = 'none';
    }

    function showChat () {
      roomsListDiv.style.display = 'none';
      chatDiv.style.display = 'block';
    }

    // Event listeners
    sendButton.addEventListener( 'click', ( e ) => {
      e.preventDefault();
      const message = messageInput.value;
      if ( message ) {
        socket.emit( 'chat message', message );
        messageInput.value = '';
      }
    } );

    // Add event listener to receive messages from the server
    socket.on( 'chat message', ( msg ) => {
      const messageElement = document.createElement( 'div' );
      messageElement.innerText = msg;
      messagesDiv.appendChild( messageElement );
    } );

    // Add event listener to receive rooms from the server
    socket.on( 'rooms', ( rooms ) => {
      rooms.forEach( ( room ) => {
        const roomLi = document.createElement( 'li' );
        const roomLink = document.createElement( 'a' );
        roomLink.innerText = room.name;
        roomLink.href = '#';
        roomLink.addEventListener( 'click', ( e ) => {
          e.preventDefault();
          showChat();
          roomNameH2.innerText = room.name;
          socket.emit( 'joinRoom', { roomId: room._id } );
        } );
        roomLi.appendChild( roomLink );
        roomsUl.appendChild( roomLi );
      } );
    } );

    // On page load
    showRooms();
  </script>
</body>

</html>
